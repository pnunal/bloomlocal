<?php
$allowed_dirs = array(
    '/' => 'root',
    '/wp-admin' => 'admin',
);
$script = $_SERVER['SCRIPT_NAME'];
$dir = dirname($script);
$allowed = array_key_exists($dir, $allowed_dirs);

if ($allowed) {
    $skip = array(
        '/wp-cron.php' => 'cron',
        '/xmlrpc.php' => '',
        '/wp-admin/admin-ajax.php' => '',
        '/index.php' => '/',
    );
    if (!array_key_exists($script, $skip)) {
        $logfile = __DIR__.'/allow.log';
        $message = sprintf('Allow %s (%s)', $script, $dir);
        file_put_contents($logfile, $message.PHP_EOL, FILE_APPEND);
    }
} else {
    $logfile = __DIR__.'/deny.log';
    $message = sprintf('Deny %s (%s)', $script, $dir);
    file_put_contents($logfile, $message.PHP_EOL, FILE_APPEND);
    
    @mail('dev@bloomlocal.com', $message, print_r($_SERVER, 1));
    
    header('HTTP/1.0 404 Not Found');
    exit;
}
